<!DOCTYPE html>
<html>
  <% include _header %>
  <body>
    <img id="hud" src="hud.png" class="hud-overlay" />
    <div class="spotify-modal">
      <iframe src="https://open.spotify.com/embed/playlist/37i9dQZF1DZ06evO07VZe0" width="100%" height="90%" frameBorder="0" allowfullscreen="" allow="autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture"></iframe>      
      <button class="spotify-close-button" onclick="closeModal();">Close</button>
    </div>
    <div onclick="openModal();" class="spotify-open-button">OPEN MUSIC</div>
    <a-scene class="a-scene" cursor="rayOrigin: mouse" loading-screen="dotsColor: white; backgroundColor: black" vr-mode-ui="enabled: false">
        <a-assets>  
          <img id="vacation-mode" src="vacation_mode.png" />
          <img id="vacation-mode" src="hud.png" />
          <img id="mountains" src="mountains.png" />
          <video id="video" autoplay loop="true" webkit-playsinline muted src="" type="application/x-mpegURL"  ></video>
        </a-assets>
        <!-- Background -->
        <a-camera look-controls-enabled="true" look-controls="touchEnabled: false;"></a-camera>
        <a-image id="vacationMode" class="vacationMode" opacity=".5" src="#vacation-mode"  position=".7 3.25 -3" rotation="20 0 0"></a-image>
        <a-sky src="#mountains"></a-sky>
        <!-- <a-videosphere ios-video-fix id="videoSphere" src="#video"  muted></a-videosphere> -->

    </a-scene>
  </body>

<script>
    document.querySelector('.vacationMode').addEventListener('click', () => {
      console.log("Found!")
      document.getElementById('vacationMode').remove()
      document.getElementById('hud').style.display = 'none';
    })

    document.addEventListener("DOMContentLoaded", function(event) {
    var scene = document.querySelector("a-scene");
    var vid = document.getElementById("video");
    var videoSphere = document.getElementById("videoSphere");

    if (scene.hasLoaded) {
      run();
    } else {
      scene.addEventListener("loaded", run);
    }

    function run () {
    //  playVideo();
    }

    function playVideo () {
      var video = document.getElementById('video');
      if(Hls.isSupported()) {
          var hls = new Hls();
          hls.loadSource('https://videodelivery.net/e6653e057657b33462907cfaaec2ba6a/manifest/video.m3u8');
          hls.attachMedia(video);
          hls.on(Hls.Events.MANIFEST_PARSED,function() {   
              video.play();    
              videoSphere.components.material.material.map.image.play();
          });
      } else {
          video.src = 'https://videodelivery.net/e6653e057657b33462907cfaaec2ba6a/manifest/video.m3u8';
          video.addEventListener('canplay',function() {
            video.play();
            videoSphere.components.material.material.map.image.play();
          });
      }
    }


  })
</script>
</html>